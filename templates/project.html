{% extends "base.html" %}

{% block title %}À propos du Projet - CNN MongoDB{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="display-5 mb-3"><i class="fas fa-info-circle me-2"></i>À propos du Projet</h1>
        <p class="lead"
            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 600;">
            Classification de la Langue des Signes avec CNN et MongoDB</p>
    </div>
</div>

<!-- Description du Projet -->
<div class="row mb-4">
    <div class="col-lg-8">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-project-diagram me-2"></i>Description du Projet</h5>
            </div>
            <div class="card-body">
                <h6>Objectif</h6>
                <p>
                    Ce projet vise à créer une application web capable de reconnaître les lettres de la
                    <strong>langue des signes américaine (ASL)</strong> à partir d'images. Le système utilise
                    un réseau de neurones convolutif (CNN) pour classifier 35 classes différentes (chiffres 1-9
                    et lettres A-Z).
                </p>

                <h6>Technologies Utilisées</h6>
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li><i class="fab fa-python text-primary me-2"></i><strong>Python 3.11</strong> - Langage
                                principal</li>
                            <li><i class="fas fa-flask text-success me-2"></i><strong>Flask</strong> - Framework web
                            </li>
                            <li><i class="fas fa-brain text-warning me-2"></i><strong>TensorFlow/Keras</strong> - Deep
                                Learning</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li><i class="fas fa-database text-info me-2"></i><strong>MongoDB</strong> - Base de données
                                NoSQL</li>
                            <li><i class="fas fa-cloud-download-alt text-secondary me-2"></i><strong>Kaggle</strong> -
                                Dataset source</li>
                            <li><i class="fab fa-bootstrap text-purple me-2"></i><strong>Bootstrap 5</strong> -
                                Interface</li>
                        </ul>
                    </div>
                </div>

                <h6>Dataset</h6>
                <p>
                    Le modèle est entraîné sur le dataset
                    <a href="https://www.kaggle.com/datasets/harshvardhan21/sign-language-detection-using-images"
                        target="_blank">
                        Sign Language Detection Using Images
                    </a> de Kaggle, contenant des milliers d'images de gestes de la main représentant
                    les lettres et chiffres de l'ASL.
                </p>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Statistiques Modèle</h5>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Taille d'entrée</span>
                        <strong>{{ model_info.input_size }}</strong>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Nombre de classes</span>
                        <strong>{{ model_info.num_classes }}</strong>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Mode couleur</span>
                        <strong>{{ 'Grayscale' if model_info.grayscale else 'RGB' }}</strong>
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Modèle chargé</span>
                        <strong class="{{ 'text-success' if model_info.is_loaded else 'text-danger' }}">
                            {{ 'Oui' if model_info.is_loaded else 'Non' }}
                        </strong>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Architecture CNN -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0"><i class="fas fa-layer-group me-2"></i>Architecture du CNN</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Structure du Réseau</h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-striped">
                                <thead>
                                    <tr>
                                        <th>Couche</th>
                                        <th>Type</th>
                                        <th>Paramètres</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>Input</td>
                                        <td>64×64×3 (RGB)</td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>Rescaling</td>
                                        <td>1./255</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>Conv2D</td>
                                        <td>32 filtres, 3×3, ReLU</td>
                                    </tr>
                                    <tr>
                                        <td>4</td>
                                        <td>MaxPooling2D</td>
                                        <td>2×2</td>
                                    </tr>
                                    <tr>
                                        <td>5</td>
                                        <td>Conv2D</td>
                                        <td>64 filtres, 3×3, ReLU</td>
                                    </tr>
                                    <tr>
                                        <td>6</td>
                                        <td>MaxPooling2D</td>
                                        <td>2×2</td>
                                    </tr>
                                    <tr>
                                        <td>7</td>
                                        <td>Conv2D</td>
                                        <td>128 filtres, 3×3, ReLU</td>
                                    </tr>
                                    <tr>
                                        <td>8</td>
                                        <td>MaxPooling2D</td>
                                        <td>2×2</td>
                                    </tr>
                                    <tr>
                                        <td>9</td>
                                        <td>Flatten</td>
                                        <td>-</td>
                                    </tr>
                                    <tr>
                                        <td>10</td>
                                        <td>Dense</td>
                                        <td>512 unités, ReLU</td>
                                    </tr>
                                    <tr>
                                        <td>11</td>
                                        <td>Dropout</td>
                                        <td>0.5</td>
                                    </tr>
                                    <tr>
                                        <td>12</td>
                                        <td>Dense</td>
                                        <td>256 unités, ReLU</td>
                                    </tr>
                                    <tr>
                                        <td>13</td>
                                        <td>Dense (Output)</td>
                                        <td>35 unités, Softmax</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>Visualisation</h6>
                        <div class="cnn-diagram p-3 bg-light rounded">
                            <div class="d-flex flex-wrap justify-content-center align-items-center gap-2">
                                <div class="cnn-block input-block">
                                    <small>Input</small>
                                    <div>64×64×3</div>
                                </div>
                                <i class="fas fa-arrow-right text-muted"></i>
                                <div class="cnn-block conv-block">
                                    <small>Conv2D</small>
                                    <div>32</div>
                                </div>
                                <i class="fas fa-arrow-right text-muted"></i>
                                <div class="cnn-block conv-block">
                                    <small>Conv2D</small>
                                    <div>64</div>
                                </div>
                                <i class="fas fa-arrow-right text-muted"></i>
                                <div class="cnn-block conv-block">
                                    <small>Conv2D</small>
                                    <div>128</div>
                                </div>
                                <i class="fas fa-arrow-right text-muted"></i>
                                <div class="cnn-block dense-block">
                                    <small>Dense</small>
                                    <div>512</div>
                                </div>
                                <i class="fas fa-arrow-right text-muted"></i>
                                <div class="cnn-block output-block">
                                    <small>Output</small>
                                    <div>35</div>
                                </div>
                            </div>
                        </div>

                        <h6 class="mt-4">Hyperparamètres d'Entraînement</h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between">
                                <span>Optimiseur</span><strong>Adam</strong>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span>Fonction de perte</span><strong>Sparse Categorical Crossentropy</strong>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span>Époques</span><strong>5</strong>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span>Batch Size</span><strong>32</strong>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Description détaillée des couches -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <h5 class="mb-0 text-white"><i class="fas fa-book me-2"></i>Description Détaillée des Couches</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Input Layer -->
                    <div class="col-md-6 mb-4">
                        <div class="layer-card p-3 rounded"
                            style="background: rgba(23, 162, 184, 0.1); border-left: 4px solid #17a2b8;">
                            <h6 class="text-info"><i class="fas fa-sign-in-alt me-2"></i>Input Layer (64×64×3)</h6>
                            <p class="mb-0">
                                <strong>Rôle :</strong> Point d'entrée du réseau. Reçoit les images RGB de 64×64 pixels.
                                <br><strong>Pourquoi :</strong> Standardise la taille des images. 64×64 est un bon
                                compromis entre qualité et vitesse.
                            </p>
                        </div>
                    </div>

                    <!-- Rescaling -->
                    <div class="col-md-6 mb-4">
                        <div class="layer-card p-3 rounded"
                            style="background: rgba(108, 117, 125, 0.1); border-left: 4px solid #6c757d;">
                            <h6 class="text-secondary"><i class="fas fa-compress me-2"></i>Rescaling (1./255)</h6>
                            <p class="mb-0">
                                <strong>Rôle :</strong> Normalise les pixels de [0-255] vers [0-1].
                                <br><strong>Pourquoi :</strong> Accélère la convergence et améliore la stabilité de
                                l'entraînement.
                            </p>
                        </div>
                    </div>

                    <!-- Conv2D -->
                    <div class="col-md-6 mb-4">
                        <div class="layer-card p-3 rounded"
                            style="background: rgba(40, 167, 69, 0.1); border-left: 4px solid #28a745;">
                            <h6 class="text-success"><i class="fas fa-th me-2"></i>Conv2D (Convolution 2D)</h6>
                            <p class="mb-0">
                                <strong>Rôle :</strong> Détecte les caractéristiques visuelles en appliquant des
                                filtres.
                                <br><strong>32→64→128 filtres :</strong> Progression des caractéristiques simples
                                (bords) vers complexes (formes de doigts).
                                <br><strong>ReLU :</strong> Introduit la non-linéarité pour apprendre des relations
                                complexes.
                            </p>
                        </div>
                    </div>

                    <!-- MaxPooling2D -->
                    <div class="col-md-6 mb-4">
                        <div class="layer-card p-3 rounded"
                            style="background: rgba(0, 123, 255, 0.1); border-left: 4px solid #007bff;">
                            <h6 class="text-primary"><i class="fas fa-compress-arrows-alt me-2"></i>MaxPooling2D (2×2)
                            </h6>
                            <p class="mb-0">
                                <strong>Rôle :</strong> Réduit la dimension en gardant les valeurs maximales.
                                <br><strong>Pourquoi :</strong> Moins de calculs, robustesse aux translations, conserve
                                l'essentiel.
                            </p>
                        </div>
                    </div>

                    <!-- Flatten -->
                    <div class="col-md-6 mb-4">
                        <div class="layer-card p-3 rounded"
                            style="background: rgba(111, 66, 193, 0.1); border-left: 4px solid #6f42c1;">
                            <h6 style="color: #6f42c1;"><i class="fas fa-stream me-2"></i>Flatten</h6>
                            <p class="mb-0">
                                <strong>Rôle :</strong> Transforme les feature maps 2D en vecteur 1D.
                                <br><strong>Pourquoi :</strong> Pont entre couches convolutives (2D) et couches Dense
                                (1D).
                            </p>
                        </div>
                    </div>

                    <!-- Dense -->
                    <div class="col-md-6 mb-4">
                        <div class="layer-card p-3 rounded"
                            style="background: rgba(255, 193, 7, 0.1); border-left: 4px solid #ffc107;">
                            <h6 class="text-warning"><i class="fas fa-project-diagram me-2"></i>Dense (Fully Connected)
                            </h6>
                            <p class="mb-0">
                                <strong>Rôle :</strong> Combine toutes les caractéristiques pour la classification.
                                <br><strong>512→256 unités :</strong> Apprend des combinaisons complexes puis affine
                                avant la sortie.
                            </p>
                        </div>
                    </div>

                    <!-- Dropout -->
                    <div class="col-md-6 mb-4">
                        <div class="layer-card p-3 rounded"
                            style="background: rgba(220, 53, 69, 0.1); border-left: 4px solid #dc3545;">
                            <h6 class="text-danger"><i class="fas fa-random me-2"></i>Dropout (0.5)</h6>
                            <p class="mb-0">
                                <strong>Rôle :</strong> Désactive aléatoirement 50% des neurones pendant l'entraînement.
                                <br><strong>Pourquoi :</strong> Empêche le sur-apprentissage et améliore la
                                généralisation.
                            </p>
                        </div>
                    </div>

                    <!-- Output Layer -->
                    <div class="col-md-6 mb-4">
                        <div class="layer-card p-3 rounded"
                            style="background: rgba(233, 30, 99, 0.1); border-left: 4px solid #e91e63;">
                            <h6 style="color: #e91e63;"><i class="fas fa-sign-out-alt me-2"></i>Output (35 unités,
                                Softmax)</h6>
                            <p class="mb-0">
                                <strong>Rôle :</strong> Produit les probabilités pour chaque classe (1-9, A-Z).
                                <br><strong>Softmax :</strong> Convertit les scores en probabilités qui somment à 1.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Graphiques d'Entraînement -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Accuracy</h5>
            </div>
            <div class="card-body">
                <canvas id="accuracyChart" height="200"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Loss</h5>
            </div>
            <div class="card-body">
                <canvas id="lossChart" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Classes -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="fas fa-th me-2"></i>Classes Supportées ({{ model_info.num_classes }})</h5>
            </div>
            <div class="card-body">
                <div class="d-flex flex-wrap gap-2">
                    {% for cls in model_info.classes %}
                    <span class="badge bg-primary fs-6 px-3 py-2">{{ cls }}</span>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .cnn-block {
        text-align: center;
        padding: 10px 15px;
        border-radius: 8px;
        min-width: 60px;
    }

    .cnn-block small {
        display: block;
        font-size: 0.7rem;
        opacity: 0.8;
    }

    .input-block {
        background: #17a2b8;
        color: white;
    }

    .conv-block {
        background: #28a745;
        color: white;
    }

    .dense-block {
        background: #ffc107;
        color: black;
    }

    .output-block {
        background: #dc3545;
        color: white;
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Données d'entraînement (à remplacer par des données réelles via API)
    const trainingData = {{ training_history | tojson | safe }};

    // Graphique Accuracy
    const accCtx = document.getElementById('accuracyChart').getContext('2d');
    new Chart(accCtx, {
        type: 'line',
        data: {
            labels: trainingData.epochs,
            datasets: [{
                label: 'Training Accuracy',
                data: trainingData.accuracy,
                borderColor: 'rgb(40, 167, 69)',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                fill: true,
                tension: 0.3
            }, {
                label: 'Validation Accuracy',
                data: trainingData.val_accuracy,
                borderColor: 'rgb(0, 123, 255)',
                backgroundColor: 'rgba(0, 123, 255, 0.1)',
                fill: true,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 1,
                    ticks: {
                        callback: function (value) { return (value * 100).toFixed(0) + '%'; }
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function (context) {
                            return context.dataset.label + ': ' + (context.parsed.y * 100).toFixed(2) + '%';
                        }
                    }
                }
            }
        }
    });

    // Graphique Loss
    const lossCtx = document.getElementById('lossChart').getContext('2d');
    new Chart(lossCtx, {
        type: 'line',
        data: {
            labels: trainingData.epochs,
            datasets: [{
                label: 'Training Loss',
                data: trainingData.loss,
                borderColor: 'rgb(220, 53, 69)',
                backgroundColor: 'rgba(220, 53, 69, 0.1)',
                fill: true,
                tension: 0.3
            }, {
                label: 'Validation Loss',
                data: trainingData.val_loss,
                borderColor: 'rgb(255, 193, 7)',
                backgroundColor: 'rgba(255, 193, 7, 0.1)',
                fill: true,
                tension: 0.3
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>
{% endblock %}